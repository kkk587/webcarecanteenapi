FORMAT: 1A

# Webcare Canteen API

API documentation for upcoming Webcare Canteen API.

Every request must include header Accept-Language to get response in correct language, if missing or not recognized default language is used.

` `

Authorization token is obtained through HTTP Basic Auth or by login request for card authorization. Identification of customer (or admin) is decoded from token.

    
` `


Successful response is code 200. Errors are returned as standard HTTP errors with corresponding error code (4xx - client error, 5xx - server error) and description 

When force error occurs server returns status code 449 and object with following schema
https://drive.google.com/file/d/0B1_u4k6eQMDqc3NnZy1Zcm53azQ/view?usp=sharing
Client displays alert constructed from force object and responses with force_answer or force_cancel. Only POST methods implements force error.

` `


` `

Definition of additional data objects with example: https://docs.google.com/document/d/14NSKxR2U8BEieUCxF4dxUFpR49ISOTBhmiXAw_OpBWQ/edit?usp=sharing

` `

Links returned by API can be formatted in two ways. Standard links with http:// or https:// and link to resource on page `image://product.jpg` means that path to resource is `https://server.url/image/product.jpg`

` `


All parameters and request attributes are optional by default.

` `

#Enumarated types
## CancelStatus (enum[string])
- NOT_POSSIBLE - Cannot be canceled
- FOR_EXCHANGE - Can be offered for exchange
- POSSIBLE - Can be canceled

## OrderStatus (enum[string])
- ACTIVE - Current orders
- CLOSED - Past orders
- FOR_EXCHANGE - Order offered for exchange
- CANCELED - Canceled orders

## MenuStatus (enum[string])
- CLOSED - Orders closed
- SOLD_OUT - Sold out
- SINGLE_ITEM - Available to order single item
- MULTIPLE - Available to order multiple items

## MenuTimeSpan (enum[string])
- DAY - 1 day time span
- WEEK - 7 day time span
- TIMESPAN - Configured time span of menu

## HealthIndex (enum[string])
- UNHEALTHY - Unhealthy - red
- NORMAL - Normal - orange
- HEALTHY - Healthy - green

## Menu [/menu]

### Get menu (NEW) [GET /menu?timespan={timespan}&firstDay={firstDay}&canteenId={canteenId}]
Get menu for customer. If no attributes are provided menu is based on customer default preferences set in Septim.

?? V parametrech není zdokumentovaný firstDate. A upřímně teď už ani netuším rozdíl mezi date a FirstDate. Pokud na to také nepřijdete v rámci toho, jak se to bude realizovat, tak bych nechal jenom firstDate.
    
    -- Už také nevím, nechávám jenom firstDay
    ?? OK

?? Mám za to, že jsme se bavili, že položka menu (nabídky) nemá IDčko, objednáváme recepturu.   
 
 -- O tom jsme se nebavili, ani to není možné, protože dle informace od Vás lze objednávat jídlo i když nemá přiřazenou recepturu (mail 5. 12. 2018 17:59) - položka menu (neboli jídlo) má u sebe cenu. Id jídla je několikrát zmiňováno ve Vašem zadání i a zároveň při řešení https://github.com/MRzr/webcarecanteenapi/pull/1/files/9bde635752d960ff7a82b89a4af370765f413eb8
 ?? Aha, nejedná se tedy o menu id ale o id jídla. To tam můžeme dávat to není problém a je to jasný. Jenom pro upřesnění, jídlo je každý den stejné a má každý den stejný IDčko. Proto také u objednávky potřebujeme datum a ID jídla. 
 ?? Takže přejmenovat na mealID a správně popsat
 

+ Parameters 
    - firstDay:  `dd-MM-yyyy` (string, optional) - First day of requested menu.
    - timespan: DAY (MenuTimeSpan, optional) - selected time span of order
    - canteenId: 12 (number, optional) - id of selected canteen

+ Request (application/json)
    + Headers
    
            Authorization: abc  (required) - customer authorization
        

+ Response 200 (application/json)
    + Attributes (MenuResponse)


    
## Canteens [/canteen]

### Get canteens (NEW) [GET /canteen]

Get list of canteens for customer.

+ Request (application/json)
    + Headers
    
            Authorization: abc  (customer credentials)
            
+ Response 200 (application/json)
    + Attributes (array[Canteen])


## Orders  [/order]


### Create direct order (NEW) [POST /order/direct]

Create direct order.
Returns order confirmation.

?? Měli by jsme objednávat produkt ne menu, to v podstatě neexistuje jako záznam
    
    -- Viz výše
    ?? asi vyřešeno

+ Request (application/json)
    + Headers
    
            Authorization: abc  (customer credentials)
    + Attributes (OrderDirectRequest)

        

+ Response 200 (application/json)
    + Attributes
        + success: true (boolean)
        

        
### Create order from cart (NEW) [POST /order/cart]

Create order from cart.
Returns order confirmation.

?? Stejný problém s identifikací co objednáváme    
    
    -- Viz výše
+ Request (application/json)
    + Headers
        
            Authorization: abc  (customer credentials)
    
    + Attributes (OrderCartRequest)

        

+ Response 200 (application/json)
    + Attributes
        + success: true (boolean)
        
        

### Check  order from cart (NEW) [POST /order/cart/check]

Check if order can be placed.

?? Stejný problém s identifikací co objednáváme
    
    -- Viz výše
+ Request (application/json)
    + Headers

            Authorization: abc  (customer credentials)
            
    + Attributes (OrderCartRequest)

        
+ Response 200 (application/json)
    + Attributes
        + success: true (boolean)




## Customer profile & management [/customer]

### Login with card (NEW) [POST /customer/cardlogin]

Returns customer's Basic Auth token. Identified by card reader.

+ Request (application/json)
    + Attributes
        + cardId: abc (string, optional) - Identification of card read by card reader.
        
+ Response 200 (application/json)
    + Attributes
        + token: abc (string, optional) - Authorization token for provided cardId
 


### Top up customer account (NEW) [POST /customer/account/topup]

Request customer account top up. Webcare api creates unique transaction id for payment gateway.

?? Je to v souladu s aktuálním stavem práce s branami? Nevím o ničem, jenom vím, že jsme dělali nějaké změny. 
    
    -- Ano, systém je stejný jaký se závádí do první verze - jediný rozdíl je v tom, že tady platba není vázaná na objednávku
    ?? Ještě pořád? Vím že se to zase nějak aktualizovalo a nechci to řešit. Máte mojí důvěru. 
+ Request (application/json)
    + Headers
    
            Authorization: abc (required)
    + Attributes
         + amount: 12 (number, required) - Amount to top up.

+ Response 200 (application/json)
    + Attributes 
        + transactionId: 2332 (number, required) - Unique transaction id for payment gateway.


### Get canteen orders (NEW) [GET /customer/canteenorders]

Request customer account top up. Webcare api creates unique transaction id for payment gateway.

?? Komentář je asi dost blbě
 
 -- Moje chyba opravím
 
+ Request (application/json)
    + Headers
    
            Authorization: abc (required)

+ Response 200 (application/json)
    + Attributes (array[CanteenOrder])
?? Struktura odpovědi je divná. Nemělo by tam být menuItem (to co z něj potřebujeme už máme správně v CanteenOrder)
?? Místo menuItem potřebujeme product. Párování mezi nabídkou a objednávkami musíte dělat přes datum a productId.
?? Nebojte se do tohoto komentáře dát informaci o způsobu párování za mně to sem patří. 
    -- Žádné párování neprobíhá na straně klientské aplikace neprobíhá, domluvili jsme se že chodí veškerá data kompletní (stejně jako je v Get menu). ProductId může být null a i když má hodnotu, tak není záruka, že máme zrovna máme detail receptury - v daný moment máme pouze receptury, které jsou zobrazeny ve výpisu.
    ?? platí že se nevrací menuItem, menuItem je položka nabídky. Tady se ale vrací hotové objednávky, tedy orderItem
    ?? párování na klientské straně musí probíhat, protože do nabídky musíte promítnout existující objednávky, takže párovat by se mělo přes datum a mealID
    ?? Septim by měl vracet jak mealID tak productID (ten může být null)
    

### Top up payment result (NEW) [POST /customer/topup/result]

Request between private Payment bridge and Septim API. Confirms successful payment of transaction or cancels transaction in case of error in payment.
Request is authorized with admin credentials.

?? Nerozumím tomu, proč máme dvě API metody. Až to bude k tomu (tedy víte že je zaplaceno), tak nabijeme konto.
?? Teoreticky dokážu pochopit, že by jsme Vám uchovávali identifikátor transakce mezi požadavkem na platbu a potvrzením platby. Ale pak to tady musí být popsané.
    
    -- Touto metodou payment bridge předá zprávu, že došlo k úspěšnému zaplacení transakce přes platební bránu.
    ?? OK, už se to ke mně dostalo v rámci toho jak to řešíme u nás. Nicméně pořád platí, že tady musí být popsáno jak to funguje. Nebo, pokud to funguje stejně jako jinde, tak na to musí být alespoň odkaz.
    
+ Request (application/json)
    + Headers
    
            Authorization: abc (admin credentials)
        
    + Attributes (PaymentResult)

+ Response 200 (application/json)
    + Attributes
        + success: true (boolean) - Confirmation of successful request
        
## Web API requests [/api]


### Get payment link for (NEW) [POST /api/topup/link]

Not part of Septim API
    
Request between client and payment bridge.

After payment validation, browser is redirected to specified return URL with GET parameters withpayment result. (?paymentSuccess=true)

?? tomuhle moc nerozumím a věta "Request between client and web api." tomu nepomáhá. 
    
    -- Nové označení je payment bridge - aplikace, která se stará o platby přes bránu. Tato část se netýká Septimu, ale zajištuje komunikaci mezi klientskou aplikací a payment bridge.
    ?? Asi OK

+ Request (application/json)
    + Headers
    
            Authorization: abc (customer credentials,optional)

    + Attributes (GatewayRequest)
+ Response 200
    + Attributes (GatewayResponse)
        

        

      

# Data Structure



## CancelStatus (enum[string])
- NOT_POSSIBLE - Cannot be canceled
- FOR_EXCHANGE - Can be offered for exchange
- POSSIBLE - Can be canceled

## OrderStatus (enum[string])
- ACTIVE - Current orders
- CLOSED - Past orders
- FOR_EXCHANGE - Order offered for exchange
- CANCELED - Canceled orders

## MenuStatus (enum[string])
- CLOSED - Orders closed
- SOLD_OUT - Sold out
- SINGLE_ITEM - Available to order single item
- MULTIPLE - Available to order multiple items

## MenuTimeSpan (enum[string])
- DAY - 1 day time span
- WEEK - 7 day time span
- TIMESPAN - Configured time span of menu

## HealthIndex (enum[string])
- UNHEALTHY - Unhealthy - red
- NORMAL - Normal - orange
- HEALTHY - Healthy - green

## AdditionDataComponent (enum[string])
- const-image
- const-text
- var-image
- var-text
- input-text

## Product

- id: 123 (number, required) - Product unique identificator
- name: Soup (string, required) - Product display name
- image: image://123.jpg (string, required) - Url to product image. See Introduction -  Links
- description: Product Description (string, required) - Product description text
- size: 200 ml (string, required) - Size of product (weight, volume...)
- healthIndex: HEALTHY (HealthIndex, sample, nullable, optional)
- additionalData (array[AdditionalData], optional, fixed-type) - Other product informations
- allergens (array[ProductAllergen], required, fixed-type) - List of allergens in product

## ProductAllergen

- shortName: 01 (string, required) - Short name of allergen
- longName: Shrimp (string, required) - Long name of allergen


## OrderItem
- menuItemId: 123 (number, required) - Id of meal to order
- quantity: 2 (number, required) - Quantity of ordered product. If not provided quantity is 1.


## Canteen 
- id: 77 (number, required) - Unique identificator of outlet
- name: Outlet 1 (string, required) - Display name of outlet

## MenuRequest 
- date:  `dd-MM-yyyy` (string, optional) - Date of order
- timespan: week (MenuTimeSpan, optional) - selected time span of order
- canteenId: 12 (number, optional) - id of selected canteen

## MenuResponse
- timespan: week (MenuTimeSpan, required, sample) - Displayed timespan of menu
- canteenId: 123 (number, required) - Canteen id of menu
- filters (array[MenuFilter], required, fixed-type) - Available filters for menu
- menu (array[Menu], required, fixed-type) - Menu by days

## Menu (array[MenuItem], required, fixed-type)

## MenuItem
- id: 23 (number, required) - Id of menu item
- date:  `dd-MM-yyyy` (string, required) - Date of menu item
- price: 23 (number, required) - Price of item
- name: Menu 1 (string, required) - Name of menu item
- status: SINGLE_ITEM (MenuStatus, sample, required)
- filter: vege (string, required) - Filter value of menu item
- group: launch (string, required) - Group of meal for menu item
- product (Product, nullable, optional) - Product recipe

## MenuFilter
- value: launch (string, required) - Value for filter
- label: Obed (string, required) - Label of filter

## OrderDirectRequest
- price: 300 (number, required) - Calculated price of order, price is verified with DB and if doesn't match error is thrown.
- orderDate: `dd-MM-yyyy` (string, required) - Date order will be created for
- canteenId: 12 (number, required) - Canteen for order
- item (OrderItem, required) - Item to order
- additionalData (array[AdditionalDataRequest], optional) - Other order data

## OrderCartRequest
- price: 300 (number, required) - Calculated price of order, price is verified with DB and if doesn't match error is thrown.
- orderDate: `dd-MM-yyyy` (string, required) - Date order will be created for
- canteenId: 12 (number, required) - Canteen for order.
- items (array[OrderItem], required, fixed-type) - Items to order
- additionalData (array[AdditionalDataRequest], optional) - Other order data


## Order
- id: abc (string, required) - Unique identification of order
- date:  `dd-MM-yyyy` (string, required) - Date of order
- filter: launch (string, required) - Group of order
- canteenId: 77 (number, required)
- status: ACTIVE (OrderStatus, sample, required) - Current status code of order
- price: 232 (number, required) - Total price of order
- items (array[OrderItem], required, fixed-type) - List of ordered products
- additionalData (array[AdditionalData],optional, fixed-type) - Other order informations

## CanteenOrder
- id: abc (string, required) - Unique identification of order
- date:  `dd-MM-yyyy` (string, required) - Date of order
- canteenId: 77 (number, required) - Identification of canteen
- quantity: 2 (number, required) - Quantity of ordered product. If not provided quantity is 1.
- orderPrice: 232 (number, required) - The order price.
- cancelStatus: POSSIBLE (CancelStatus, sample, required) - Cancel options
- menuItem (MenuItem, required) - Ordered menu item


## OrderConfirmation
- id: abc (string, required) - Unique identification of order
- status: ACTIVE (OrderStatus, required) - Current status code of order
- orderPrice: 232 (number, required) - The order price.


## AdditionalDataBase
- variableId: customerCountry (string, required) - Id of data object in administration
- value: Czech Republic (string, required) - Value of data object

## AdditionalData (AdditionalDataBase, fixed-type)

## AdditionalDataRequest (AdditionalDataBase)
- type: input-text (AdditionDataComponent,required, sample) - Type of data object
- label: Label (string, optional) - input label which describes the field. for type input-text
- target (string, optional) - target of data object


##GatewayRequest
- toBePaid: 111 (number, required) - The amount, which should be paid.
- returnUrl: http://return.url/ (string, required) -  Defines return adress, after payement completion

##GatewayResponse
- gatewayLink: http://link.to.gateway/payment (string, required) - Link to payment gateway


## PaymentResult
- transactionId: abc (string, required) - Id of transaction
- paymentSuccessful: true (boolean, required) - Result of payment

## PaymentResultResponse
- paid: 23 (number, required) - amount paid by customer
